# Hyper Context 前端页面设计

## 设计原则

- **直观易用**: 提供清晰的视觉层级和操作流程
- **卡片化管理**: 采用卡片式布局，便于项目管理和浏览
- **结构化编辑**: 支持目录式知识管理和格式化编辑
- **版本控制**: 完整的版本管理和稳定版标记功能

## 技术栈

- **框架**: Vue 3 + TypeScript
- **构建工具**: Vite
- **样式方案**: Tailwind CSS
- **组件库**: Headless UI + 自定义组件
- **状态管理**: Pinia
- **路由**: Vue Router
- **图标**: Heroicons
- **编辑器**: CodeMirror 6

## 整体布局架构

### 主布局结构
```
┌─────────────────────────────────────┐
│                Header               │
├─────────────────────────────────────┤
│                                     │
│            Main Content             │
│                                     │
│                                     │
└─────────────────────────────────────┘
```

### 响应式断点
- **Mobile**: < 768px
- **Tablet**: 768px - 1024px
- **Desktop**: >= 1024px

## 前端项目目录结构

### Vue3 + Vite 项目架构
```
hyper-context/
├── packages/
│   ├── frontend/                 # Vue3 前端应用
│   │   ├── public/              # 静态资源
│   │   ├── src/
│   │   │   ├── components/      # 通用组件
│   │   │   │   ├── ui/         # 基础UI组件
│   │   │   │   ├── editor/     # 编辑器相关组件
│   │   │   │   └── project/    # 项目管理组件
│   │   │   ├── views/          # 页面组件
│   │   │   │   ├── Dashboard.vue
│   │   │   │   └── ProjectEditor.vue
│   │   │   ├── stores/         # Pinia状态管理
│   │   │   │   ├── project.ts
│   │   │   │   ├── knowledge.ts
│   │   │   │   └── version.ts
│   │   │   ├── api/            # API请求管理
│   │   │   │   ├── index.ts    # API统一入口
│   │   │   │   ├── types.ts    # 接口类型定义
│   │   │   │   └── endpoints.ts # 接口端点配置
│   │   │   ├── router/         # 路由配置
│   │   │   ├── utils/          # 工具函数
│   │   │   └── styles/         # 样式文件
│   │   ├── package.json
│   │   └── vite.config.ts
│   ├── backend/                 # Next.js 后端服务
│   └── shared/                  # 共享类型和工具
├── database/                    # SQLite 数据库
├── docker/                      # Docker 配置
└── docs/                        # 项目文档
```

### 目录结构特点
- **Monorepo管理**: 使用pnpm管理多包项目
- **模块化组织**: 按功能模块组织代码结构
- **类型安全**: TypeScript全覆盖
- **统一API管理**: 集中管理所有HTTP请求

## 页面结构设计

### 1. 项目总览页 (Dashboard)
**路由**: `/`

**功能模块**:
- 项目卡片网格展示
- 快速创建项目
- 项目搜索和筛选
- 项目状态统计

**布局结构**:
```vue
<template>
  <div class="dashboard">
    <!-- 顶部操作栏 -->
    <div class="flex justify-between items-center mb-8">
      <h1 class="text-2xl font-bold">项目管理</h1>
      <div class="flex space-x-4">
        <SearchInput placeholder="搜索项目..." />
        <CreateProjectButton />
      </div>
    </div>

    <!-- 统计面板 -->
    <StatsPanel class="mb-8" />

    <!-- 项目卡片网格 -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      <ProjectCard
        v-for="project in projects"
        :key="project.id"
        :project="project"
        @click="openProject"
        @edit="editProject"
        @delete="deleteProject"
      />

      <!-- 创建新项目卡片 -->
      <CreateProjectCard @click="createProject" />
    </div>
  </div>
</template>
```

**项目卡片设计**:
```vue
<template>
  <div class="project-card bg-white rounded-lg shadow-sm border hover:shadow-md transition-shadow p-6 cursor-pointer">
    <!-- 项目头部 -->
    <div class="flex justify-between items-start mb-4">
      <h3 class="text-lg font-semibold truncate">{{ project.name }}</h3>
      <div class="flex space-x-2">
        <VersionBadge :version="project.stableVersion" />
        <DropdownMenu>
          <DropdownItem @click="editProject">编辑</DropdownItem>
          <DropdownItem @click="exportProject">导出</DropdownItem>
          <DropdownItem @click="deleteProject" class="text-red-600">删除</DropdownItem>
        </DropdownMenu>
      </div>
    </div>

    <!-- 项目描述 -->
    <p class="text-gray-600 text-sm mb-4 line-clamp-2">{{ project.description }}</p>

    <!-- 项目信息 -->
    <div class="flex justify-between items-center text-sm text-gray-500">
      <span>{{ project.knowledgeCount }} 个知识点</span>
      <span>{{ formatDate(project.updatedAt) }}</span>
    </div>

    <!-- MCP 状态指示器 -->
    <div class="mt-4 flex items-center space-x-2">
      <div class="flex items-center space-x-1">
        <div :class="mcpStatusClass"></div>
        <span class="text-xs">MCP {{ project.mcpStatus }}</span>
      </div>
    </div>
  </div>
</template>
```

### 2. 项目编辑页 (Project Editor)
**路由**: `/project/:id`

**功能模块**:
- 左侧知识目录树
- 中央内容编辑区（集成版本管理）
- 顶部工具栏

**布局结构**:
```vue
<template>
  <div class="project-editor h-screen flex flex-col">
    <!-- 顶部工具栏 -->
    <EditorHeader />

    <div class="flex-1 flex overflow-hidden">
      <!-- 左侧知识目录树 -->
      <div class="w-80 bg-gray-50 border-r flex flex-col">
        <KnowledgeTree />
      </div>

      <!-- 中央编辑区域（包含版本管理） -->
      <div class="flex-1 flex flex-col">
        <KnowledgeEditor />
      </div>
    </div>
  </div>
</template>
```

### 3. 知识编辑器 (Knowledge Editor)
**支持的知识格式**:

#### Main 内容格式
```
# 身份设定

你是一个专业的 Recce 开发助手，熟悉 Recce 框架的各种功能和最佳实践。

## 核心能力

- 帮助开发者理解 Recce 框架的核心概念
- 提供准确的 API 使用指导
- 解答开发过程中的技术问题
```

#### 知识点格式
```xml
<head>
<name>cli</name>
<level>core</level>
<description>Recce 的常用 cli 指令</description>
</head>

<content>

## cargo check
编译项目，检查报错内容

## recce new
新建项目，需执行两步：
- 选择模板。目前仅支持 recce-biz
- 输入项目名称

成功后即会在同目录下新建项目文件夹。

## recce run
编译并启动项目

## recce build
仅编译项目

</content>

<extend>

<block>
<name>recce_entry</name>
<level>core</level>
<description>#[recce_entry] 是一个属性宏，用于标记 Recce 应用的入口函数</description>
<content>
主要功能
- 自动初始化: 宏会自动插入 Recce 框架运行所必需的初始化代码
- 跨平台入口适配: 根据编译目标生成不同的入口点
- 启动应用实例: 执行函数体，获取 App 实例，启动渲染循环
- 统一错误处理: 捕获错误，记录日志，上报错误信息
</content>
</block>

</extend>
```

**编辑器界面**:
```vue
<template>
  <div class="knowledge-editor flex flex-col h-full">
    <!-- 编辑器工具栏（集成版本管理） -->
    <div class="border-b p-4 bg-white">
      <div class="flex justify-between items-center">
        <div class="flex items-center space-x-4">
          <h2 class="font-semibold">{{ currentFile?.name || 'main' }}</h2>
          <KnowledgeLevelBadge :level="currentFile?.level" />

          <!-- 版本选择器 -->
          <div class="flex items-center space-x-2">
            <Select v-model="currentVersionId" @change="switchVersion">
              <option
                v-for="version in versions"
                :key="version.id"
                :value="version.id"
              >
                v{{ version.version }}
                <span v-if="version.isStable" class="text-green-600">（稳定版）</span>
              </option>
            </Select>
            <Button
              v-if="!currentVersion?.isStable"
              @click="markAsStable"
              size="sm"
              variant="outline"
            >
              标记稳定版
            </Button>
          </div>
        </div>

        <div class="flex space-x-2">
          <Button @click="createNewVersion" variant="outline">新建版本</Button>
          <Button @click="saveKnowledge" variant="primary">保存</Button>
          <Button @click="previewPrompt">预览提示词</Button>
          <Button @click="testMcp" variant="outline">测试MCP</Button>
        </div>
      </div>
    </div>

    <!-- 编辑器主体 -->
    <div class="flex-1 flex">
      <!-- 左侧编辑区 -->
      <div class="flex-1 p-4">
        <div v-if="currentFile?.name === 'main'">
          <!-- Main 内容编辑器 -->
          <MarkdownEditor
            v-model="mainContent"
            placeholder="输入项目的主要描述和设定..."
          />
        </div>
        <div v-else>
          <!-- 结构化知识编辑器 -->
          <StructuredKnowledgeEditor
            v-model="knowledgeData"
            @add-extend="addExtendBlock"
          />
        </div>
      </div>

      <!-- 右侧预览区 -->
      <div class="w-1/2 border-l p-4 bg-gray-50">
        <div class="space-y-4">
          <!-- 知识预览 -->
          <div class="bg-white rounded-lg border p-4">
            <h4 class="font-medium mb-3">知识预览</h4>
            <KnowledgePreview :content="previewContent" />
          </div>

          <!-- 版本历史 -->
          <div class="bg-white rounded-lg border p-4">
            <h4 class="font-medium mb-3">版本历史</h4>
            <div class="space-y-2 max-h-48 overflow-y-auto">
              <VersionHistoryItem
                v-for="version in versions"
                :key="version.id"
                :version="version"
                :is-current="version.id === currentVersionId"
                @switch="switchToVersion"
                @delete="deleteVersion"
              />
            </div>
          </div>

          <!-- MCP 状态 -->
          <div class="bg-white rounded-lg border p-4">
            <div class="flex justify-between items-center">
              <span class="text-sm font-medium">MCP 服务</span>
              <McpStatusBadge :status="mcpStatus" />
            </div>
            <div class="text-xs text-gray-500 mt-1">
              稳定版: v{{ stableVersion?.version || 'N/A' }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
```

### 4. 结构化知识编辑器
```vue
<template>
  <div class="structured-editor space-y-6">
    <!-- 知识头部信息 -->
    <div class="bg-white rounded-lg border p-4">
      <h3 class="text-sm font-medium text-gray-700 mb-3">基本信息</h3>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <Label>知识名称</Label>
          <Input v-model="knowledge.name" />
        </div>
        <div>
          <Label>知识等级</Label>
          <Select v-model="knowledge.level">
            <option value="core">核心知识</option>
            <option value="non-core">非核心知识</option>
          </Select>
        </div>
      </div>
      <div class="mt-4">
        <Label>描述</Label>
        <Textarea v-model="knowledge.description" />
      </div>
    </div>

    <!-- 知识内容编辑 -->
    <div class="bg-white rounded-lg border p-4">
      <h3 class="text-sm font-medium text-gray-700 mb-3">知识内容</h3>
      <MarkdownEditor v-model="knowledge.content" />
    </div>

    <!-- 扩展知识管理 -->
    <div class="bg-white rounded-lg border p-4">
      <div class="flex justify-between items-center mb-3">
        <h3 class="text-sm font-medium text-gray-700">扩展知识</h3>
        <Button @click="addExtendBlock" size="sm">添加扩展</Button>
      </div>

      <div class="space-y-4">
        <ExtendBlock
          v-for="(extend, index) in knowledge.extends"
          :key="index"
          v-model="knowledge.extends[index]"
          @remove="removeExtendBlock(index)"
        />
      </div>
    </div>
  </div>
</template>
```

### 5. 版本管理面板 (Version Panel)
```vue
<template>
  <div class="version-panel h-full flex flex-col">
    <!-- 版本面板头部 -->
    <div class="p-4 border-b bg-white">
      <div class="flex justify-between items-center">
        <h3 class="font-semibold">版本管理</h3>
        <div class="flex space-x-2">
          <Button @click="createVersion" size="sm">新建版本</Button>
        </div>
      </div>
    </div>

    <!-- 当前版本信息 -->
    <div class="p-4 bg-blue-50 border-b">
      <div class="flex items-center justify-between">
        <div>
          <div class="font-medium">当前版本: v{{ currentVersion.version }}</div>
          <div class="text-sm text-gray-600">{{ formatDate(currentVersion.createdAt) }}</div>
        </div>
        <div class="flex items-center space-x-2">
          <StableVersionBadge v-if="currentVersion.isStable" />
          <Button
            v-if="!currentVersion.isStable"
            @click="markAsStable"
            size="sm"
            variant="outline"
          >
            标记为稳定版
          </Button>
        </div>
      </div>
    </div>

    <!-- 版本历史列表 -->
    <div class="flex-1 overflow-y-auto">
      <div class="p-4 space-y-3">
        <VersionItem
          v-for="version in versions"
          :key="version.id"
          :version="version"
          :is-current="version.id === currentVersion.id"
          @switch="switchToVersion"
          @mark-stable="markVersionAsStable"
          @delete="deleteVersion"
        />
      </div>
    </div>

    <!-- MCP 配置状态 -->
    <div class="border-t p-4 bg-gray-50">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-sm font-medium">MCP 服务状态</div>
          <div class="text-xs text-gray-600">
            稳定版: v{{ stableVersion?.version || 'N/A' }}
          </div>
        </div>
        <McpStatusIndicator :status="mcpStatus" />
      </div>
    </div>
  </div>
</template>
```

### 6. 知识目录树 (Knowledge Tree)
```vue
<template>
  <div class="knowledge-tree h-full flex flex-col">
    <!-- 目录树头部 -->
    <div class="p-4 border-b bg-white">
      <div class="flex justify-between items-center">
        <h3 class="font-semibold">知识目录</h3>
        <div class="flex space-x-1">
          <DropdownMenu>
            <template #trigger>
              <Button size="sm" variant="ghost">
                <PlusIcon class="w-4 h-4" />
              </Button>
            </template>
            <DropdownItem @click="addKnowledge">添加知识</DropdownItem>
            <DropdownItem @click="addFolder">添加文件夹</DropdownItem>
          </DropdownMenu>
        </div>
      </div>
    </div>

    <!-- 主内容项 -->
    <div class="border-b">
      <TreeItem
        :item="{ name: 'main', type: 'main', level: 'core', icon: 'document' }"
        :is-selected="selectedItem?.name === 'main'"
        @select="selectItem"
      />
    </div>

    <!-- 知识目录内容 -->
    <div class="flex-1 overflow-y-auto p-2">
      <TreeNode
        v-for="node in knowledgeTree"
        :key="node.id"
        :node="node"
        :selected-item="selectedItem"
        @select="selectItem"
        @rename="renameItem"
        @delete="deleteItem"
        @add-child="addChildItem"
      />
    </div>

    <!-- 底部操作区 -->
    <div class="border-t p-4 space-y-2">
      <Button @click="previewCorePrompt" class="w-full" variant="outline" size="sm">
        预览核心提示词
      </Button>
    </div>
  </div>
</template>
```

## 前端 API 请求统一管理

### API 服务层架构

#### API 统一入口 (src/api/index.ts)
```typescript
import axios, { AxiosInstance, AxiosRequestConfig } from 'axios'
import { useAuthStore } from '@/stores/auth'
import { showErrorMessage } from '@/utils/message'

class ApiService {
  private client: AxiosInstance

  constructor() {
    this.client = axios.create({
      baseURL: import.meta.env.VITE_API_BASE_URL || '/api',
      timeout: 10000,
      headers: {
        'Content-Type': 'application/json'
      }
    })

    this.setupInterceptors()
  }

  private setupInterceptors() {
    // 请求拦截器
    this.client.interceptors.request.use(
      (config) => {
        const authStore = useAuthStore()
        if (authStore.token) {
          config.headers.Authorization = `Bearer ${authStore.token}`
        }
        return config
      },
      (error) => Promise.reject(error)
    )

    // 响应拦截器
    this.client.interceptors.response.use(
      (response) => response.data,
      (error) => {
        if (error.response?.status === 401) {
          const authStore = useAuthStore()
          authStore.logout()
        }

        const message = error.response?.data?.message || error.message
        showErrorMessage(message)

        return Promise.reject(error)
      }
    )
  }

  async get<T>(url: string, config?: AxiosRequestConfig): Promise<T> {
    return this.client.get(url, config)
  }

  async post<T>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    return this.client.post(url, data, config)
  }

  async put<T>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    return this.client.put(url, data, config)
  }

  async delete<T>(url: string, config?: AxiosRequestConfig): Promise<T> {
    return this.client.delete(url, config)
  }
}

export const apiService = new ApiService()
```

#### API 接口类型定义 (src/api/types.ts)
```typescript
// 通用响应类型
export interface ApiResponse<T = any> {
  code: number
  message: string
  data: T
  timestamp: string
}

// 分页响应类型
export interface PaginatedResponse<T> {
  items: T[]
  total: number
  page: number
  pageSize: number
  totalPages: number
}

// 项目相关类型
export interface Project {
  id: string
  name: string
  description: string
  knowledgeCount: number
  stableVersion: string
  mcpStatus: 'active' | 'inactive' | 'error'
  createdAt: string
  updatedAt: string
}

export interface CreateProjectRequest {
  name: string
  description?: string
}

// 知识相关类型
export interface Knowledge {
  id: string
  name: string
  level: 'core' | 'non-core'
  description: string
  content: string
  extends: ExtendBlock[]
  projectId: string
  createdAt: string
  updatedAt: string
}

export interface ExtendBlock {
  name: string
  level: 'core' | 'non-core'
  description: string
  content: string
}

// 版本相关类型
export interface Version {
  id: string
  version: string
  isStable: boolean
  projectId: string
  author: string
  changes: string[]
  createdAt: string
}

// MCP 相关类型
export interface McpTestResult {
  status: 'success' | 'error'
  message: string
  responseTime: number
  data?: any
}
```

#### API 端点配置 (src/api/endpoints.ts)
```typescript
import { apiService } from './index'
import type {
  Project,
  CreateProjectRequest,
  Knowledge,
  Version,
  McpTestResult,
  PaginatedResponse
} from './types'

export const projectApi = {
  // 获取项目列表
  getProjects(): Promise<Project[]> {
    return apiService.get('/projects')
  },

  // 创建项目
  createProject(data: CreateProjectRequest): Promise<Project> {
    return apiService.post('/projects', data)
  },

  // 获取项目详情
  getProject(id: string): Promise<Project> {
    return apiService.get(`/projects/${id}`)
  },

  // 更新项目
  updateProject(id: string, data: Partial<Project>): Promise<Project> {
    return apiService.put(`/projects/${id}`, data)
  },

  // 删除项目
  deleteProject(id: string): Promise<void> {
    return apiService.delete(`/projects/${id}`)
  }
}

export const knowledgeApi = {
  // 获取知识列表
  getKnowledgeList(projectId: string): Promise<Knowledge[]> {
    return apiService.get(`/projects/${projectId}/knowledge`)
  },

  // 获取知识详情
  getKnowledge(projectId: string, knowledgeId: string): Promise<Knowledge> {
    return apiService.get(`/projects/${projectId}/knowledge/${knowledgeId}`)
  },

  // 创建知识
  createKnowledge(projectId: string, data: Partial<Knowledge>): Promise<Knowledge> {
    return apiService.post(`/projects/${projectId}/knowledge`, data)
  },

  // 更新知识
  updateKnowledge(projectId: string, knowledgeId: string, data: Partial<Knowledge>): Promise<Knowledge> {
    return apiService.put(`/projects/${projectId}/knowledge/${knowledgeId}`, data)
  },

  // 删除知识
  deleteKnowledge(projectId: string, knowledgeId: string): Promise<void> {
    return apiService.delete(`/projects/${projectId}/knowledge/${knowledgeId}`)
  },

  // 生成核心提示词
  generateCorePrompt(projectId: string, version?: string): Promise<string> {
    const params = version ? { version } : {}
    return apiService.get(`/projects/${projectId}/prompt/core`, { params })
  }
}

export const versionApi = {
  // 获取版本列表
  getVersions(projectId: string): Promise<Version[]> {
    return apiService.get(`/projects/${projectId}/versions`)
  },

  // 创建新版本
  createVersion(projectId: string, data: { changes: string[] }): Promise<Version> {
    return apiService.post(`/projects/${projectId}/versions`, data)
  },

  // 标记稳定版
  markAsStable(projectId: string, versionId: string): Promise<Version> {
    return apiService.put(`/projects/${projectId}/versions/${versionId}/stable`)
  },

  // 删除版本
  deleteVersion(projectId: string, versionId: string): Promise<void> {
    return apiService.delete(`/projects/${projectId}/versions/${versionId}`)
  }
}

export const mcpApi = {
  // 测试 MCP 连接
  testConnection(projectId: string): Promise<McpTestResult> {
    return apiService.post(`/projects/${projectId}/mcp/test`)
  },

  // 获取 MCP 状态
  getStatus(projectId: string): Promise<{ status: string; lastChecked: string }> {
    return apiService.get(`/projects/${projectId}/mcp/status`)
  }
}
```

### MCP 测试界面简化设计

#### MCP 测试组件 (简化版)
```vue
<template>
  <div class="mcp-test bg-white rounded-lg border p-4">
    <div class="flex justify-between items-center mb-4">
      <h4 class="font-medium">MCP 服务测试</h4>
      <div class="flex items-center space-x-2">
        <McpStatusBadge :status="mcpStatus" />
        <Button @click="testMcpConnection" :loading="testing" size="sm">
          测试连接
        </Button>
      </div>
    </div>

    <!-- 测试结果 -->
    <div v-if="testResult" class="space-y-3">
      <div class="flex items-center space-x-2">
        <span class="text-sm font-medium">测试结果:</span>
        <StatusBadge :status="testResult.status" />
        <span class="text-xs text-gray-500">{{ testResult.responseTime }}ms</span>
      </div>

      <div v-if="testResult.message" class="text-sm text-gray-600">
        {{ testResult.message }}
      </div>

      <!-- 详细信息 -->
      <details v-if="testResult.data" class="text-xs">
        <summary class="cursor-pointer text-gray-500 hover:text-gray-700">
          查看详细信息
        </summary>
        <pre class="mt-2 p-2 bg-gray-50 rounded overflow-x-auto">{{ JSON.stringify(testResult.data, null, 2) }}</pre>
      </details>
    </div>

    <!-- 自动生成说明 -->
    <div class="mt-4 text-xs text-gray-500 border-t pt-3">
      <p>MCP 服务配置和端点会基于稳定版本自动生成</p>
      <p>无需手动配置，只需确保项目有稳定版本即可</p>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { mcpApi } from '@/api/endpoints'
import type { McpTestResult } from '@/api/types'

const props = defineProps<{
  projectId: string
}>()

const testing = ref(false)
const testResult = ref<McpTestResult | null>(null)
const mcpStatus = ref<'active' | 'inactive' | 'error'>('inactive')

const testMcpConnection = async () => {
  testing.value = true
  try {
    testResult.value = await mcpApi.testConnection(props.projectId)
    mcpStatus.value = testResult.value.status === 'success' ? 'active' : 'error'
  } catch (error) {
    mcpStatus.value = 'error'
    testResult.value = {
      status: 'error',
      message: '连接失败',
      responseTime: 0
    }
  } finally {
    testing.value = false
  }
}
</script>
```

## 核心组件设计

### 1. 项目卡片组件 (ProjectCard)
```typescript
interface ProjectCardProps {
  project: {
    id: string
    name: string
    description: string
    knowledgeCount: number
    stableVersion: string
    mcpStatus: 'active' | 'inactive' | 'error'
    updatedAt: Date
  }
}
```

### 2. 知识编辑器组件 (KnowledgeEditor)
```typescript
interface KnowledgeData {
  name: string
  level: 'core' | 'non-core'
  description: string
  content: string
  extends: ExtendBlock[]
}

interface ExtendBlock {
  name: string
  level: 'core' | 'non-core'
  description: string
  content: string
}
```

### 3. 版本管理组件 (VersionManager)
```typescript
interface Version {
  id: string
  version: string
  isStable: boolean
  createdAt: Date
  author: string
  changes: string[]
}
```

## 核心提示词生成逻辑

### 生成规则
1. **Main 内容**: 始终放在最顶部
2. **核心知识**: 所有 level 为 'core' 的知识内容
3. **扩展知识索引**:
   - 核心扩展知识显示完整描述
   - 非核心扩展知识显示省略号

### 生成示例
```markdown
# 身份设定

你是一个专业的 Recce 开发助手...

# Recce 知识树
- cli/
  - name: cargo
  - name: recce
- components/
  - name: button
  - name: input

# Recce 核心知识详情

=====
name: cli
desc: Recce 的常用 cli 指令
=====

## cargo check
编译项目，检查报错内容

## recce new
新建项目...

扩展知识索引
- recce_entry: #[recce_entry] 是一个属性宏，用于标记 Recce 应用的入口函数
- ...省略的其他扩展知识

=====
name: button
desc: Recce 按钮组件的使用方法
=====

按钮组件提供了统一的交互样式...

扩展知识索引
- button_variants: 按钮的不同变体和样式
- button_events: 按钮事件处理机制
- ...省略的其他扩展知识
```

## 路由配置

```typescript
const routes = [
  {
    path: '/',
    name: 'Dashboard',
    component: Dashboard,
    meta: { title: '项目管理' }
  },
  {
    path: '/project/:id',
    name: 'ProjectEditor',
    component: ProjectEditor,
    meta: { title: '项目编辑' }
  },
  {
    path: '/project/:id/prompt-preview',
    name: 'PromptPreview',
    component: PromptPreview,
    meta: { title: '提示词预览' }
  }
]
```

## 状态管理

### 项目管理 Store
```typescript
export const useProjectStore = defineStore('project', {
  state: () => ({
    projects: [] as Project[],
    currentProject: null as Project | null,
    loading: false
  }),

  actions: {
    async fetchProjects() {},
    async createProject(data: CreateProjectData) {},
    async updateProject(id: string, data: UpdateProjectData) {},
    async deleteProject(id: string) {},
    async exportProject(id: string) {}
  }
})
```

### 知识管理 Store
```typescript
export const useKnowledgeStore = defineStore('knowledge', {
  state: () => ({
    knowledgeTree: [] as KnowledgeNode[],
    currentKnowledge: null as KnowledgeData | null,
    isDirty: false
  }),

  actions: {
    async loadKnowledgeTree(projectId: string) {},
    async saveKnowledge(knowledge: KnowledgeData) {},
    async deleteKnowledge(id: string) {},
    async generateCorePrompt() {}
  }
})
```

### API 管理 Store
```typescript
export const useApiStore = defineStore('api', {
  state: () => ({
    apiConfigs: [] as ApiConfig[],
    currentApiConfig: null as ApiConfig | null,
    mcpStatus: 'inactive' as 'active' | 'inactive' | 'error',
    testResults: {} as Record<string, TestResult>
  }),

  actions: {
    async loadApiConfigs(projectId: string) {},
    async saveApiConfig(config: ApiConfig) {},
    async testEndpoint(endpoint: Endpoint) {},
    async deployMcpService(projectId: string) {},
    async generateMcpConfig(projectId: string) {}
  }
})
```

### 项目目录 Store
```typescript
export const useDirectoryStore = defineStore('directory', {
  state: () => ({
    projectDirectory: null as ProjectDirectory | null,
    selectedItem: null as DirectoryItem | null,
    expandedFolders: new Set<string>()
  }),

  actions: {
    async loadProjectDirectory(projectId: string) {},
    async createItem(parentPath: string, item: CreateItemData) {},
    async renameItem(path: string, newName: string) {},
    async deleteItem(path: string) {},
    async moveItem(fromPath: string, toPath: string) {}
  }
})
```

### 版本管理 Store
```typescript
export const useVersionStore = defineStore('version', {
  state: () => ({
    versions: [] as Version[],
    currentVersion: null as Version | null,
    stableVersion: null as Version | null
  }),

  actions: {
    async createVersion() {},
    async switchToVersion(versionId: string) {},
    async markAsStable(versionId: string) {},
    async deleteVersion(versionId: string) {}
  }
})
```

## UI/UX 设计规范

### 1. 颜色系统
```css
:root {
  /* 主色调 */
  --primary-50: #eff6ff;
  --primary-500: #3b82f6;
  --primary-600: #2563eb;
  --primary-700: #1d4ed8;

  /* 状态色 */
  --success: #10b981;
  --warning: #f59e0b;
  --error: #ef4444;
  --info: #6b7280;

  /* 知识等级色 */
  --core-knowledge: #8b5cf6;
  --non-core-knowledge: #6b7280;
}
```

### 2. 组件样式
```css
.project-card {
  @apply bg-white rounded-lg shadow-sm border p-6 hover:shadow-md transition-all duration-200 cursor-pointer;
}

.knowledge-badge {
  @apply inline-flex items-center px-2 py-1 rounded-full text-xs font-medium;
}

.knowledge-badge--core {
  @apply bg-purple-100 text-purple-800;
}

.knowledge-badge--non-core {
  @apply bg-gray-100 text-gray-800;
}

.version-badge {
  @apply inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800;
}

.stable-badge {
  @apply inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-800;
}
```

### 3. 交互动画
```css
.fade-enter-active, .fade-leave-active {
  transition: opacity 0.3s ease;
}

.fade-enter-from, .fade-leave-to {
  opacity: 0;
}

.slide-enter-active, .slide-leave-active {
  transition: transform 0.3s ease;
}

.slide-enter-from {
  transform: translateX(-100%);
}

.slide-leave-to {
  transform: translateX(100%);
}
```

## MCP 接口集成

### 接口定义
```typescript
interface McpKnowledgeApi {
  getKnowledgeIndex(projectId: string): Promise<KnowledgeIndex[]>
  getKnowledge(projectId: string, knowledgeName: string): Promise<KnowledgeDetail>
  getCorePrompt(projectId: string): Promise<string>
}

interface KnowledgeIndex {
  name: string
  description: string
  level: 'core' | 'non-core'
}

interface KnowledgeDetail {
  name: string
  content: string
  extends: ExtendBlock[]
}
```

### 服务状态监控
```vue
<template>
  <div class="mcp-status flex items-center space-x-2">
    <div :class="statusIndicatorClass"></div>
    <span class="text-sm">{{ statusText }}</span>
  </div>
</template>

<script setup lang="ts">
const mcpStatus = computed(() => {
  // 根据当前稳定版本和MCP服务状态确定状态
  if (!stableVersion.value) return 'inactive'
  if (mcpService.isConnected) return 'active'
  return 'error'
})
</script>
```

这个更新后的前端页面设计完全基于您的新需求，采用卡片式项目管理，支持结构化知识编辑，完整的版本管理和稳定版标记功能，以及与MCP接口的深度集成。